/*
 * jsTree 0.9.9b
 * http://jstree.com/
 *
 * Copyright (c) 2009 Ivan Bozhanov (vakata.com)
 * Modified by a2h (http://a2h.uni.cc/) to revert "fix" for theme_path
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Date: 2010-02-17
 *
 */

(function(h){function e(){return{cntr:++e.cntr,settings:h.extend({},h.tree.defaults),init:function(a,b){var c=this;this.container=h(a);if(this.container.size==0)return false;e.inst[this.cntr]=this;this.container.attr("id")||this.container.attr("id","jstree_"+this.cntr);e.inst[this.container.attr("id")]=e.inst[this.cntr];e.focused=this.cntr;this.settings=h.extend(true,{},this.settings,b);if(this.settings.languages&&this.settings.languages.length){this.current_lang=this.settings.languages[0];a=false;
b="#"+this.container.attr("id");for(var d=0;d<this.settings.languages.length;d++){a=e.add_css(b+" ."+this.settings.languages[d]);if(a!==false)a.style.display=this.settings.languages[d]==this.current_lang?"":"none"}}else this.current_lang=false;this.container.addClass("tree");if(this.settings.ui.theme_name!==false){this.settings.ui.theme_path===false&&h("script").each(function(){if(this.src.toString().match(/jquery\.tree.*?js$/)){c.settings.ui.theme_path=this.src.toString().replace(/jquery\.tree.*?js$/,
"")+"themes/"+c.settings.ui.theme_name+"/style.css";return false}});if(this.settings.ui.theme_path!=""&&h.inArray(this.settings.ui.theme_path,e.themes)==-1){e.add_sheet({url:this.settings.ui.theme_path});e.themes.push(this.settings.ui.theme_path)}this.container.addClass("tree-"+this.settings.ui.theme_name)}a="";for(var f in this.settings.types)if(this.settings.types.hasOwnProperty(f))if(this.settings.types[f].icon)if(this.settings.types[f].icon.image||this.settings.types[f].icon.position){a+=f=="default"?
"#"+this.container.attr("id")+" li > a ins { ":"#"+this.container.attr("id")+" li[rel="+f+"] > a ins { ";if(this.settings.types[f].icon.image)a+=" background-image:url("+this.settings.types[f].icon.image+"); ";if(this.settings.types[f].icon.position)a+=" background-position:"+this.settings.types[f].icon.position+"; ";a+="} "}a!=""&&e.add_sheet({str:a});if(this.settings.rules.multiple)this.selected_arr=[];this.locked=this.hovered=this.offset=false;if(e.drag_drop.marker===false)e.drag_drop.marker=h("<div>").attr({id:"jstree-marker"}).hide().appendTo("body");
this.callback("oninit",[this]);this.refresh();this.attach_events();this.focus()},refresh:function(a){if(this.locked)return this.error("LOCKED");var b=this;if(a&&!this.settings.data.async)a=false;this.is_partial_refresh=a?true:false;this.opened=Array();if(this.settings.opened!=false){h.each(this.settings.opened,function(){this.replace(/^#/,"").length>0&&b.opened.push("#"+this.replace(/^#/,""))});this.settings.opened=false}else this.container.find("li.open").each(function(){this.id&&b.opened.push("#"+
this.id)});if(this.selected){this.settings.selected=Array();if(a)h(a).find("li:has(a.clicked)").each(function(){this.id&&b.settings.selected.push("#"+this.id)});else if(this.selected_arr)h.each(this.selected_arr,function(){this.attr("id")&&b.settings.selected.push("#"+this.attr("id"))});else this.selected.attr("id")&&this.settings.selected.push("#"+this.selected.attr("id"))}else if(this.settings.selected!==false){var c=Array();if((typeof this.settings.selected).toLowerCase()=="object")h.each(this.settings.selected,
function(){this.replace(/^#/,"").length>0&&c.push("#"+this.replace(/^#/,""))});else this.settings.selected.replace(/^#/,"").length>0&&c.push("#"+this.settings.selected.replace(/^#/,""));this.settings.selected=c}if(a&&this.settings.data.async){this.opened=Array();a=this.get_node(a);a.find("li.open").each(function(){b.opened.push("#"+this.id)});a.hasClass("open")&&a.removeClass("open").addClass("closed");a.hasClass("leaf")&&a.removeClass("leaf");a.children("ul:eq(0)").html("");return this.open_branch(a,
true,function(){b.reselect.apply(b)})}b=this;var d=new h.tree.datastores[this.settings.data.type];if(this.container.children("ul").size()==0)this.container.html("<ul class='ltr' style='direction:ltr;'><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(this.settings.lang.loading||"Loading ...")+"</a></li></ul>");d.load(this.callback("beforedata",[false,this]),this,this.settings.data.opts,function(f){f=b.callback("ondata",[f,b]);d.parse(f,b,b.settings.data.opts,function(g){g=b.callback("onparse",
[g,b]);b.container.empty().append(h("<ul class='ltr'>").html(g));b.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");b.container.find("li").not(".open").not(".closed").addClass("leaf");b.reselect()})})},reselect:function(a){var b=this;if(a)this.cl_count--;else this.cl_count=0;if(this.opened&&this.opened.length){a=false;for(var c=0;this.opened&&c<this.opened.length;c++)if(this.settings.data.async){var d=this.get_node(this.opened[c]);if(d.size()&&
d.hasClass("closed")>0){a=true;d=this.opened[c].toString().replace("/","\\/");delete this.opened[c];this.open_branch(d,true,function(){b.reselect.apply(b,[true])});this.cl_count++}}else this.open_branch(this.opened[c],true);if(this.settings.data.async&&a)return;if(this.cl_count>0)return;delete this.opened}if(!(this.cl_count>0)){this.container.css("direction","ltr").children("ul:eq(0)").addClass("ltr");this.settings.ui.dots==false&&this.container.children("ul:eq(0)").addClass("no_dots");if(this.scrtop){this.container.scrollTop(b.scrtop);
delete this.scrtop}if(this.settings.selected!==false){h.each(this.settings.selected,function(f){b.is_partial_refresh?b.select_branch(h(b.settings.selected[f].toString().replace("/","\\/"),b.container),b.settings.rules.multiple!==false):b.select_branch(h(b.settings.selected[f].toString().replace("/","\\/"),b.container),b.settings.rules.multiple!==false&&f>0)});this.settings.selected=false}this.callback("onload",[b])}},get:function(a,b,c){if(!b)b=this.settings.data.type;if(!c)c=this.settings.data.opts;
return(new h.tree.datastores[b]).get(a,this,c)},attach_events:function(){var a=this;this.container.bind("mousedown.jstree",function(b){if(e.drag_drop.isdown){e.drag_drop.move_type=false;b.preventDefault();b.stopPropagation();b.stopImmediatePropagation();return false}}).bind("mouseup.jstree",function(){setTimeout(function(){a.focus.apply(a)},5)}).bind("click.jstree",function(){return true});h("li",this.container[0]).live("click",function(b){if(b.target.tagName!="LI")return true;a.off_height();if(b.pageY-
h(b.target).offset().top>a.li_height)return true;a.toggle_branch.apply(a,[b.target]);b.stopPropagation();return false});h("a",this.container[0]).live("click",function(b){if(b.which&&b.which==3)return true;if(a.locked){b.preventDefault();b.target.blur();return a.error("LOCKED")}a.select_branch.apply(a,[b.target,b.ctrlKey||b.metaKey||a.settings.rules.multiple=="on"]);a.inp&&a.inp.blur();b.preventDefault();b.target.blur();return false}).live("dblclick",function(b){if(a.locked){b.preventDefault();b.stopPropagation();
b.target.blur();return a.error("LOCKED")}a.callback("ondblclk",[a.get_node(b.target).get(0),a]);b.preventDefault();b.stopPropagation();b.target.blur()}).live("contextmenu",function(b){if(a.locked){b.target.blur();return a.error("LOCKED")}return a.callback("onrgtclk",[a.get_node(b.target).get(0),a,b])}).live("mouseover",function(b){if(a.locked){b.preventDefault();b.stopPropagation();return a.error("LOCKED")}if(a.hovered!==false&&(b.target.tagName=="A"||b.target.tagName=="INS")){a.hovered.children("a").removeClass("hover");
a.hovered=false}a.callback("onhover",[a.get_node(b.target).get(0),a])}).live("mousedown",function(b){if(a.settings.rules.drag_button=="left"&&b.which&&b.which!=1)return true;if(a.settings.rules.drag_button=="right"&&b.which&&b.which!=3)return true;a.focus.apply(a);if(a.locked)return a.error("LOCKED");var c=a.get_node(b.target);if(a.settings.rules.multiple!=false&&a.selected_arr.length>1&&c.children("a:eq(0)").hasClass("clicked")){var d=0;for(var f in a.selected_arr)if(a.selected_arr.hasOwnProperty(f))if(a.check("draggable",
a.selected_arr[f])){a.selected_arr[f].addClass("dragged");e.drag_drop.origin_tree=a;d++}if(d>0){e.drag_drop.drag_node=a.check("draggable",c)?c:a.container.find("li.dragged:eq(0)");e.drag_drop.isdown=true;e.drag_drop.drag_help=h("<div id='jstree-dragged' class='tree "+(a.settings.ui.theme_name!=""?" tree-"+a.settings.ui.theme_name:"")+"' />").append("<ul class='"+a.container.children("ul:eq(0)").get(0).className+"' />");d=e.drag_drop.drag_node.clone();a.settings.languages.length>0&&d.find("a").not("."+
a.current_lang).hide();e.drag_drop.drag_help.children("ul:eq(0)").append(d);e.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last").children("a").html("<ins>&nbsp;</ins>Multiple selection").end().children("ul").remove();e.drag_drop.dragged=a.container.find("li.dragged")}}else if(a.check("draggable",c)){e.drag_drop.drag_node=c;e.drag_drop.drag_help=h("<div id='jstree-dragged' class='tree "+(a.settings.ui.theme_name!=""?" tree-"+a.settings.ui.theme_name:"")+"' />").append("<ul class='"+
a.container.children("ul:eq(0)").get(0).className+"' />");d=c.clone();a.settings.languages.length>0&&d.find("a").not("."+a.current_lang).hide();e.drag_drop.drag_help.children("ul:eq(0)").append(d);e.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last");e.drag_drop.isdown=true;e.drag_drop.foreign=false;e.drag_drop.origin_tree=a;c.addClass("dragged");e.drag_drop.dragged=a.container.find("li.dragged")}e.drag_drop.init_x=b.pageX;e.drag_drop.init_y=b.pageY;c.blur();b.preventDefault();
b.stopPropagation();return false})},focus:function(){if(this.locked)return false;if(e.focused!=this.cntr){e.focused=this.cntr;this.callback("onfocus",[this])}},off_height:function(){if(this.offset===false){this.container.css({position:"relative"});this.offset=this.container.offset();var a=0;if(a=parseInt(h.curCSS(this.container.get(0),"paddingTop",true),10))this.offset.top+=a;if(a=parseInt(h.curCSS(this.container.get(0),"borderTopWidth",true),10))this.offset.top+=a;this.container.css({position:""})}if(!this.li_height){a=
this.container.find("ul li.closed, ul li.leaf").eq(0);this.li_height=a.height();if(a.children("ul:eq(0)").size())this.li_height-=a.children("ul:eq(0)").height();if(!this.li_height)this.li_height=18}},scroll_check:function(a,b){var c=this,d=c.container,f=c.container.offset(),g=d.scrollTop(),j=d.scrollLeft(),k=d.get(0).scrollWidth>d.width()?40:20;b-f.top<20&&d.scrollTop(Math.max(g-c.settings.ui.scroll_spd,0));d.height()-(b-f.top)<k&&d.scrollTop(g+c.settings.ui.scroll_spd);a-f.left<20&&d.scrollLeft(Math.max(j-
c.settings.ui.scroll_spd,0));d.width()-(a-f.left)<40&&d.scrollLeft(j+c.settings.ui.scroll_spd);if(d.scrollLeft()!=j||d.scrollTop()!=g){e.drag_drop.move_type=false;e.drag_drop.ref_node=false;e.drag_drop.marker.hide()}e.drag_drop.scroll_time=setTimeout(function(){c.scroll_check(a,b)},50)},scroll_into_view:function(a){a=a?this.get_node(a):this.selected;if(!a)return false;a=a.offset().top;var b=this.container.offset().top,c=b+this.container.height(),d=this.container.get(0).scrollWidth>this.container.width()?
40:20;a+5<b&&this.container.scrollTop(this.container.scrollTop()-(b-a+5));a+d>c&&this.container.scrollTop(this.container.scrollTop()+(a+d-c))},get_node:function(a){return h(a).closest("li")},get_type:function(a){if(a=!a?this.selected:this.get_node(a))return a.attr(this.settings.rules.type_attr)||"default"},set_type:function(a,b){(b=!b?this.selected:this.get_node(b))&&a&&b.attr(this.settings.rules.type_attr,a)},get_text:function(a,b){a=this.get_node(a);if(!a||a.size()==0)return"";if(this.settings.languages&&
this.settings.languages.length){b=b?b:this.current_lang;a=a.children("a."+b)}else a=a.children("a:visible");var c="";a.contents().each(function(){if(this.nodeType==3){c=this.data;return false}});return c},check:function(a,b){if(this.locked)return false;var c=false;if(b===-1){if(typeof this.settings.rules[a]!="undefined")c=this.settings.rules[a]}else{b=!b?this.selected:this.get_node(b);if(!b)return;var d=this.get_type(b);if(typeof this.settings.types[d]!="undefined"&&typeof this.settings.types[d][a]!=
"undefined")c=this.settings.types[d][a];else if(typeof this.settings.types["default"]!="undefined"&&typeof this.settings.types["default"][a]!="undefined")c=this.settings.types["default"][a]}if(typeof c=="function")c=c.call(null,b,this);return c=this.callback("check",[a,b,c,this])},check_move:function(a,b,c){if(this.locked)return false;if(h(b).closest("li.dragged").size())return false;var d=a.parents(".tree:eq(0)").get(0),f=b===-1?this.container.get(0):b.parents(".tree:eq(0)").get(0);if(d&&d!=f){f=
h.tree.reference(f.id).settings.rules.multitree;if(typeof f=="object")f=h.makeArray(f);if(f=="none"||h.isArray(f)&&h.inArray(d.id,f)==-1)return false}f=c!="inside"?this.parent(b):this.get_node(b);if(b===-1)f=-1;a=this.get_node(a);if(f==false)return false;d={max_depth:this.settings.rules.use_max_depth?this.check("max_depth",f):-1,max_children:this.settings.rules.use_max_children?this.check("max_children",f):-1,valid_children:this.check("valid_children",f)};var g=typeof a=="string"?a:this.get_type(a);
if(typeof d.valid_children!="undefined"&&(d.valid_children=="none"||typeof d.valid_children=="object"&&h.inArray(g,h.makeArray(d.valid_children))==-1))return false;if(this.settings.rules.use_max_children)if(typeof d.max_children!="undefined"&&d.max_children!=-1){if(d.max_children==0)return false;g=1;if(e.drag_drop.moving==true&&e.drag_drop.foreign==false){g=e.drag_drop.dragged.size();g-=f.find("> ul > li.dragged").size()}if(d.max_children<f.find("> ul > li").size()+g)return false}if(this.settings.rules.use_max_depth){if(typeof d.max_depth!=
"undefined"&&d.max_depth===0)return this.error("MOVE: MAX-DEPTH REACHED");d=d.max_depth>0?d.max_depth:false;g=0;for(var j=f;j!==-1;){j=this.parent(j);g++;f=this.check("max_depth",j);if(f>=0)d=d===false?f-g:Math.min(d,f-g);if(d!==false&&d<=0)return this.error("MOVE: MAX-DEPTH REACHED")}if(d!==false&&d<=0)return this.error("MOVE: MAX-DEPTH REACHED");if(d!==false){f=1;if(typeof a!="string")for(j=a;j.size()>0;){if(d-f<0)return this.error("MOVE: MAX-DEPTH REACHED");j=j.children("ul").children("li");f++}}}if(this.callback("check_move",
[a,b,c,this])==false)return false;return true},hover_branch:function(a){if(this.locked)return this.error("LOCKED");var b=this;a=b.get_node(a);if(!a.size())return this.error("HOVER: NOT A VALID NODE");if(!b.check("clickable",a))return this.error("SELECT: NODE NOT SELECTABLE");this.hovered&&this.hovered.children("A").removeClass("hover");this.hovered=a;this.hovered.children("a").addClass("hover");this.scroll_into_view(this.hovered)},select_branch:function(a,b){if(this.locked)return this.error("LOCKED");
if(!a&&this.hovered!==false)a=this.hovered;var c=this;a=c.get_node(a);if(!a.size())return this.error("SELECT: NOT A VALID NODE");a.children("a").removeClass("hover");if(!c.check("clickable",a))return this.error("SELECT: NODE NOT SELECTABLE");if(c.callback("beforechange",[a.get(0),c])===false)return this.error("SELECT: STOPPED BY USER");if(this.settings.rules.multiple!=false&&b&&a.children("a.clicked").size()>0)return this.deselect_branch(a);this.settings.rules.multiple!=false&&b&&this.selected_arr.push(a);
if(this.settings.rules.multiple!=false&&!b){for(var d in this.selected_arr)if(this.selected_arr.hasOwnProperty(d)){this.selected_arr[d].children("A").removeClass("clicked");this.callback("ondeselect",[this.selected_arr[d].get(0),c])}this.selected_arr=[];this.selected_arr.push(a);if(this.selected&&this.selected.children("A").hasClass("clicked")){this.selected.children("A").removeClass("clicked");this.callback("ondeselect",[this.selected.get(0),c])}}if(!this.settings.rules.multiple)if(this.selected){this.selected.children("A").removeClass("clicked");
this.callback("ondeselect",[this.selected.get(0),c])}this.selected=a;if(this.hovered!==false){this.hovered.children("A").removeClass("hover");this.hovered=a}this.selected.children("a").addClass("clicked").end().parents("li.closed").each(function(){c.open_branch(this,true)});this.scroll_into_view(this.selected);this.callback("onselect",[this.selected.get(0),c]);this.callback("onchange",[this.selected.get(0),c])},deselect_branch:function(a){if(this.locked)return this.error("LOCKED");var b=this;a=this.get_node(a);
if(a.children("a.clicked").size()==0)return this.error("DESELECT: NODE NOT SELECTED");a.children("a").removeClass("clicked");this.callback("ondeselect",[a.get(0),b]);if(this.settings.rules.multiple!=false&&this.selected_arr.length>1){this.selected_arr=[];this.container.find("a.clicked").filter(":first-child").parent().each(function(){b.selected_arr.push(h(this))});if(a.get(0)==this.selected.get(0))this.selected=this.selected_arr[0]}else{if(this.settings.rules.multiple!=false)this.selected_arr=[];
this.selected=false}this.callback("onchange",[a.get(0),b])},toggle_branch:function(a){if(this.locked)return this.error("LOCKED");a=this.get_node(a);if(a.hasClass("closed"))return this.open_branch(a);if(a.hasClass("open"))return this.close_branch(a)},open_branch:function(a,b,c){var d=this;if(this.locked)return this.error("LOCKED");a=this.get_node(a);if(!a.size())return this.error("OPEN: NO SUCH NODE");if(a.hasClass("leaf"))return this.error("OPEN: OPENING LEAF NODE");if(this.settings.data.async&&a.find("li").size()==
0){a.children("a").addClass("loading");this._load_branch(a,function(){d.open_branch(a,b,c)})}else{a.children("a").removeClass("loading");if(this.callback("beforeopen",[a.get(0),this])===false)return this.error("OPEN: STOPPED BY USER");if(parseInt(this.settings.ui.animation)>0&&!b){a.children("ul:eq(0)").css("display","none");a.removeClass("closed").addClass("open");a.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation),function(){h(this).css("display","");c&&c.call()})}else{a.removeClass("closed").addClass("open");
c&&c.call()}this.callback("onopen",[a.get(0),this]);return true}},close_branch:function(a,b){if(this.locked)return this.error("LOCKED");var c=this;a=this.get_node(a);if(!a.size())return this.error("CLOSE: NO SUCH NODE");if(c.callback("beforeclose",[a.get(0),c])===false)return this.error("CLOSE: STOPPED BY USER");if(parseInt(this.settings.ui.animation)>0&&!b&&a.children("ul:eq(0)").size()==1)a.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation),function(){a.hasClass("open")&&a.removeClass("open").addClass("closed");
h(this).css("display","");c.callback("onclose",[a.get(0),c])});else{a.hasClass("open")&&a.removeClass("open").addClass("closed");this.callback("onclose",[a.get(0),this])}if(this.selected&&this.settings.ui.selected_parent_close!==false&&a.children("ul:eq(0)").find("a.clicked").size()>0){a.find("li:has(a.clicked)").each(function(){c.deselect_branch(this)});this.settings.ui.selected_parent_close=="select_parent"&&a.children("a.clicked").size()==0&&this.select_branch(a,this.settings.rules.multiple!=false&&
this.selected_arr.length>0)}},open_all:function(a,b){if(this.locked)return this.error("LOCKED");var c=this;a=a?this.get_node(a):this.container;var d=a.find("li.closed").size();if(b)this.cl_count--;else this.cl_count=0;if(d>0){this.cl_count+=d;a.find("li.closed").each(function(){var f=this;c.open_branch.apply(c,[this,true,function(){c.open_all.apply(c,[f,true])}])})}else this.cl_count==0&&this.callback("onopen_all",[this])},close_all:function(a){if(this.locked)return this.error("LOCKED");var b=this;
a=a?this.get_node(a):this.container;a.find("li.open").each(function(){b.close_branch(this,true)});this.callback("onclose_all",[this])},set_lang:function(a){if(!h.isArray(this.settings.languages)||this.settings.languages.length==0)return false;if(this.locked)return this.error("LOCKED");if(!h.inArray(a,this.settings.languages)&&typeof this.settings.languages[a]!="undefined")a=this.settings.languages[a];if(typeof a=="undefined")return false;if(a==this.current_lang)return true;var b=false,c="#"+this.container.attr("id");
b=e.get_css(c+" ."+this.current_lang);if(b!==false)b.style.display="none";b=e.get_css(c+" ."+a);if(b!==false)b.style.display="";this.current_lang=a;return true},get_lang:function(){if(!h.isArray(this.settings.languages)||this.settings.languages.length==0)return false;return this.current_lang},_load_branch:function(a,b){var c=this;a=this.get_node(a);if(!a.size())return this.error("LOAD: NO SUCH NODE");if(this.settings.data.async){var d=new h.tree.datastores[this.settings.data.type];d.load(this.callback("beforedata",
[a,this]),this,this.settings.data.opts,function(f){f=c.callback("ondata",[f,c]);if(!f||f.length==0){a.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove();b&&b.call()}else d.parse(f,c,c.settings.data.opts,function(g){g=c.callback("onparse",[g,c]);a.children("ul").remove();a.append(h("<ul>").html(g));a.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");a.find("li").not(".open").not(".closed").addClass("leaf");b&&b.call()})})}},
_create:function(a,b,c,d){if(b!=-1)b=this.get_node(b);if(typeof c=="undefined")c="inside";if(b!=-1&&c!="after"&&c!="before"&&b.hasClass("closed")&&this.settings.data.async&&b.children("ul").size()==0){var f=this;return this._load_branch(b,function(){f._create.apply(f,[a,b,c,d])})}switch(c){case "before":c=b.parent().children().index(b);b=this.parent(b);break;case "after":c=b.parent().children().index(b)+1;b=this.parent(b);break;case "inside":c=this.settings.rules.createat=="top"?0:this.children(b).size();
break;default:break}var g=b==-1?this.container:b,j=false;if(g.children("ul").size()==0){b!=-1&&!b.hasClass("open closed")&&b.removeClass("leaf").addClass("closed");j=h("<ul>");g.append(j)}else j=g.children("ul:eq(0)");if(a instanceof jQuery)g=a;else{a=this.callback("ondata",[a,this]);g=h.tree.datastores.json().parse(a,this);g=this.callback("onparse",[g,this]);g=h(g)}if(g.children("ul").size())g.is(".open")||g.addClass("closed");else g.addClass("leaf");g.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
g.find("li").not(".open").not(".closed").addClass("leaf");var k=j.children("li:nth-child("+(c+1)+")");k.size()?k.before(g):j.append(g);j.children(".last").removeClass("last").end().children("li:last-child").addClass("last");d||this.callback("oncreate",[{node:g.get(0),parent:b==-1?-1:b.get(0),position:c,is_ui:false}]);return g},create:function(a,b,c){if(this.locked)return this.error("LOCKED");if(b!=-1)b=b?this.get_node(b):this.selected;if(b!=-1&&(!b||!b.size()))return this.error("CREATE: NO NODE SELECTED");
if(typeof c=="undefined")c="inside";if(b!=-1&&c!="after"&&c!="before"&&b.hasClass("closed"))if(this.settings.data.async&&b.children("ul").size()==0){var d=this;return this.open_branch(b,true,function(){d.create.apply(d,[a,b,c])})}else this.open_branch(b,true);switch(c){case "before":c=b.parent().children().index(b);b=this.parent(b);break;case "after":c=b.parent().children().index(b)+1;b=this.parent(b);break;case "inside":c=this.settings.rules.createat=="top"?0:this.children(b).size();break;default:break}if(!this.check("creatable",
b))return this.error("CREATE: CANNOT CREATE IN NODE");var f=false;a=a?h.extend(true,{},a):{};if(!a.attributes)a.attributes={};a.attributes[this.settings.rules.type_attr]||(a.attributes[this.settings.rules.type_attr]=this.get_type(b)||"default");if(this.settings.languages.length){if(!a.data){a.data={};f=true}for(var g=0;g<this.settings.languages.length;g++)a.data[this.settings.languages[g]]||(a.data[this.settings.languages[g]]=(typeof this.settings.lang.new_node).toLowerCase()!="string"&&this.settings.lang.new_node[g]?
this.settings.lang.new_node[g]:this.settings.lang.new_node)}else if(!a.data){a.data=this.settings.lang.new_node;f=true}a=this.callback("ondata",[a,this]);f=h.tree.datastores.json().parse(a,this);f=this.callback("onparse",[f,this]);f=h(f);var j={max_depth:this.settings.rules.use_max_depth?this.check("max_depth",b):-1,max_children:this.settings.rules.use_max_children?this.check("max_children",b):-1,valid_children:this.check("valid_children",b)};if(this.settings.rules.use_max_children)if(typeof j.max_children!=
"undefined"&&j.max_children!=-1&&j.max_children>=this.children(b).size())return this.error("CREATE: MAX_CHILDREN REACHED");if(this.settings.rules.use_max_depth){if(typeof j.max_depth!="undefined"&&j.max_depth===0)return this.error("CREATE: MAX-DEPTH REACHED");j=j.max_depth>0?j.max_depth:false;g=0;for(var k=b;k!==-1;){k=this.parent(k);g++;var l=this.check("max_depth",k);if(l>=0)j=j===false?l-g:Math.min(j,l-g);if(j!==false&&j<=0)return this.error("CREATE: MAX-DEPTH REACHED")}if(j!==false&&j<=0)return this.error("CREATE: MAX-DEPTH REACHED");
if(j!==false){g=1;for(k=f;k.size()>0;){if(j-g<0)return this.error("CREATE: MAX-DEPTH REACHED");k=k.children("ul").children("li");g++}}}if(!this.callback("beforecreate",[{node:f.get(0),parent:b==-1?-1:b.get(0),position:c}]))return this.error("CREATE: STOPPED");j={};j[this.container.attr("id")]=this.get_rollback();f=this._create(f,b,c,true);this.select_branch(f.children("a:eq(0)"));this.rename(false,true,j);return f},_rename:function(a,b,c,d){a=this.get_node(a);if(!a||!a.size())return false;a=c?a.find("a."+
c):this.current_lang?a.find("a."+this.current_lang):a.find("a:first");var f=a.children("ins").clone();a.text(b).prepend(f);d||this.callback("onrename",[{node:this.get_node(a).get(0),new_name:b,lang:c?c:this.get_lang(),is_ui:false}])},rename:function(a,b,c){if(this.locked)return this.error("LOCKED");a=a?this.get_node(a):this.selected;var d=this;if(!a||!a.size())return this.error("RENAME: NO NODE SELECTED");if(!this.check("renameable",a))return this.error("RENAME: NODE NOT RENAMABLE");if(!this.callback("beforerename",
[{node:a.get(0),lang:d.current_lang}]))return this.error("RENAME: STOPPED BY USER");a.parents("li.closed").each(function(){d.open_branch(this)});var f={};f[this.container.attr("id")]=this.get_rollback();var g=a.children("a:visible"),j="";g.contents().each(function(){if(this.nodeType==3){j=this.data;return false}});d.inp=h("<input type='text' autocomplete='off' />");d.inp.val(j.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<")).bind("mousedown",function(l){l.stopPropagation()}).bind("mouseup",
function(l){l.stopPropagation()}).bind("click",function(l){l.stopPropagation()}).bind("keyup",function(l){l=l.keyCode||l.which;if(l==27){this.value=j;this.blur()}else l==13&&this.blur()});d.inp.blur(function(){if(this.value=="")this.value=j;d._rename(a,this.value,false,true);g.get(0).style.display="";g.prevAll("span").remove();d.inp=false;if(b){var l=d.parent(g);d.callback("oncreate",[{node:d.get_node(g).get(0),parent:l==-1?-1:l.get(0),new_name:this.value,lang:d.get_lang(),is_ui:true,rollback:c}])}else d.callback("onrename",
[{node:d.get_node(a).get(0),new_name:this.value,lang:d.get_lang(),is_ui:true,last_name:j,rollback:f}])});var k=h("<span />").addClass(a.attr("class")).append(g.children("ins").clone()).append(d.inp);g.get(0).style.display="none";a.prepend(k);d.inp.get(0).focus();d.inp.get(0).select()},_remove:function(a,b){a=this.get_node(a);if(!a.size())return false;var c=this,d=a.parent(),f=a.find("a.clicked").size()&&this.selected_arr?true:false,g=a.get(0)==this.selected||a.find("li").index(this.selected)!=-1?
true:false;a=a.remove();d.children("li:last").addClass("last");if(d.children("li").size()==0){$li=d.parents("li:eq(0)");$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove()}if(f){this.selected_arr=[];this.container.find("a.clicked").filter(":first-child").parent().each(function(){c.selected_arr.push(h(this))})}if(g&&this.selected_arr)this.selected=this.selected_arr[0]||false;d=this.get_node(d);b||this.callback("ondelete",[{node:objs[i].get(0),parent:d==-1?d:d.get(0),
is_ui:false}]);return a},remove:function(a){if(this.locked)return this.error("LOCKED");var b=this,c={};c[this.container.attr("id")]=this.get_rollback();var d=[];if(a)d.push(this.get_node(a));else{if(!this.selected)return this.error("DELETE: NO NODE SELECTED");if(this.selected_arr)d=h.makeArray(this.selected_arr);else d.push(this.selected);var f=this.settings.ui.selected_delete=="select_previous"?this.prev(this.selected):false}for(a=0;a<d.length;a++)if(this.check("deletable",d[a]))if(this.callback("beforedelete",
[{node:d[a]}])){var g=b.parent(d[a]);this.callback("ondelete",[{node:this._remove(d[a],true).get(0),parent:g==-1?g:g.get(0),is_ui:true,rollback:c}])}else this.error("DELETE: STOPPED BY USER");else this.error("DELETE: NODE NOT DELETABLE");f&&this.select_branch(f)},_move:function(a,b,c,d,f){a=this.get_node(a);if(b!=-1)b=this.get_node(b);if(typeof c=="undefined")c="inside";if(b!=-1&&c!="after"&&c!="before"&&b.hasClass("closed")&&this.settings.data.async&&b.children("ul").size()==0){var g=this;return this._load_branch(b,
function(){g._move.apply(g,[a,b,c,d,f])})}switch(c){case "before":c=b.parent().children().index(b);b=this.parent(b);break;case "after":c=b.parent().children().index(b)+1;b=this.parent(b);break;case "inside":c=this.settings.rules.createat=="top"?0:this.children(b).size();break;default:break}var j=b==-1?this.container:b,k=this.parent(a),l=a;if(d){l=a.clone();l.each(function(){this.id+="_copy";h(this).find("li").each(function(){this.id+="_copy"});h(this).removeClass("dragged").find("a.clicked").removeClass("clicked").end().find("li.dragged").removeClass("dragged")})}var n=
h.tree.reference(a),o=b==-1?this:h.tree.reference(b);if(n.cntr!=o.cntr){var m=[];if(n.settings.languages.length&&o.settings.languages.length){m=jQuery.map(o.settings.languages,function(p){return"."+p.toUpperCase()});l.find("a").not(m.join(",")).remove();if(!a.find("a:eq(0)").size())return this.error("MOVE: NO COMMON LANGUAGES")}else if(n.settings.languages.length){m=n.get_lang();l.find("a").not("."+m).remove();l.find("a").removeClass(m)}else if(o.settings.languages.length){m=o.get_lang();l.find("a").addClass(m)}l.find("a.clicked").removeClass("clicked")}m=
false;if(j.children("ul").size()==0){b!=-1&&!j.hasClass("open closed")&&j.removeClass("leaf").addClass("closed");m=h("<ul>");j.append(m)}else m=j.children("ul:eq(0)");j=m.children("li:nth-child("+(c+1)+")");if(j.get(0)!==l.get(0))j.size()?j.before(l.removeClass("last")):m.append(l.removeClass("last"));m.children(".last").removeClass("last").end().children("li:last-child").addClass("last");if(k===-1)k=n.container;k.children("ul").children(".last").removeClass("last").end().children("li:last-child").addClass("last");
f||this.callback(d?"onmove":"oncopy",[{node:l.get(0),parent:b==-1?-1:b.get(0),position:c,is_ui:false,old_parent:k.get(0),origin_tree:n,receiving_tree:o}]);return l},moved:function(a,b,c,d,f){if(b!=-1)b=this.get_node(b);if(typeof c=="undefined")c="inside";if(b!=-1&&c!="after"&&c!="before"&&b.hasClass("closed")&&this.settings.data.async&&b.children("ul").size()==0){var g=this;return this.open_branch(b,true,function(){g.moved.apply(g,[a,b,c,d,f])})}if(h(a).size()>1){g=this;var j=this.moved(a.eq(0),b,
c,d,f);a.each(function(m){if(m!=0)if(j)j=g.moved(this,j,"after",d,f)});return a}if(!this.check_move(a,b,c))return false;a=this.get_node(a);switch(c){case "before":c=b.parent().children().index(b);b=this.parent(b);break;case "after":c=b.parent().children().index(b)+1;b=this.parent(b);break;case "inside":c=this.settings.rules.createat=="top"?0:this.children(b).size();break;default:break}var k=this.parent(a),l=h.tree.reference(a),n=b==-1?this:h.tree.reference(b);if(!this.callback(d?"beforecopy":"beforemove",
[{node:a.get(0),parent:b==-1?-1:b.get(0),position:c,is_ui:false,old_parent:k==-1?-1:k.get(0),origin_tree:l,receiving_tree:n}]))return false;if(!f){f={};f[l.container.attr("id")]=l.get_rollback();f[n.container.attr("id")]=n.get_rollback()}var o=this._move(a,b,c,d,true);if(o){g=this;o.parents(".closed").each(function(){g.open_branch(this)})}this.callback(d?"oncopy":"onmove",[{node:o.get(0),parent:b==-1?-1:b.get(0),position:c,is_ui:true,old_parent:k==-1?-1:k.get(0),origin_tree:l,receiving_tree:n}]);
return o},next:function(a,b){a=this.get_node(a);if(!a.size())return false;if(b)return a.nextAll("li").size()>0?a.nextAll("li:eq(0)"):false;return a.hasClass("open")?a.find("li:eq(0)"):a.nextAll("li").size()>0?a.nextAll("li:eq(0)"):a.parents("li").next("li").eq(0)},prev:function(a,b){a=this.get_node(a);if(!a.size())return false;if(b)return a.prevAll("li").size()>0?a.prevAll("li:eq(0)"):false;if(a.prev("li").size()){for(a=a.prev("li").eq(0);a.hasClass("open");)a=a.children("ul:eq(0)").children("li:last");
return a}else return a.parents("li:eq(0)").size()?a.parents("li:eq(0)"):false},parent:function(a){a=this.get_node(a);if(!a.size())return false;return a.parents("li:eq(0)").size()?a.parents("li:eq(0)"):-1},children:function(a){if(a===-1)return this.container.children("ul:eq(0)").children("li");a=this.get_node(a);if(!a.size())return false;return a.children("ul:eq(0)").children("li")},toggle_dots:function(){if(this.settings.ui.dots){this.settings.ui.dots=false;this.container.children("ul:eq(0)").addClass("no_dots")}else{this.settings.ui.dots=
true;this.container.children("ul:eq(0)").removeClass("no_dots")}},callback:function(a,b){var c=false,d=null;for(var f in this.settings.plugins)if(typeof h.tree.plugins[f]=="object"){c=h.tree.plugins[f];if(c.callbacks&&typeof c.callbacks[a]=="function")d=c.callbacks[a].apply(this,b);if(typeof d!=="undefined"&&d!==null)if(a=="ondata"||a=="onparse")b[0]=d;else return d}c=this.settings.callback[a];if(typeof c=="function")return c.apply(this,b)},get_rollback:function(){var a={};a.html=this.container.html();
a.selected=this.selected?this.selected.attr("id"):false;return a},error:function(a){this.callback("error",[a,this]);return false},lock:function(a){(this.locked=a)?this.container.children("ul:eq(0)").addClass("locked"):this.container.children("ul:eq(0)").removeClass("locked")},cut:function(a){if(this.locked)return this.error("LOCKED");a=a?this.get_node(a):this.container.find("a.clicked").filter(":first-child").parent();if(!a||!a.size())return this.error("CUT: NO NODE SELECTED");e.cut_copy.copy_nodes=
false;e.cut_copy.cut_nodes=a},copy:function(a){if(this.locked)return this.error("LOCKED");a=a?this.get_node(a):this.container.find("a.clicked").filter(":first-child").parent();if(!a||!a.size())return this.error("COPY: NO NODE SELECTED");e.cut_copy.copy_nodes=a;e.cut_copy.cut_nodes=false},paste:function(a,b){if(this.locked)return this.error("LOCKED");var c=false;if(a==-1){c=true;a=this.container}else a=a?this.get_node(a):this.selected;if(!c&&(!a||!a.size()))return this.error("PASTE: NO NODE SELECTED");
if(!e.cut_copy.copy_nodes&&!e.cut_copy.cut_nodes)return this.error("PASTE: NOTHING TO DO");var d=b;if(b=="before"){b=a.parent().children().index(a);a=a.parents("li:eq(0)")}else if(b=="after"){b=a.parent().children().index(a)+1;a=a.parents("li:eq(0)")}else if((typeof b).toLowerCase()=="undefined"||b=="inside")b=this.settings.rules.createat=="top"?0:a.children("ul:eq(0)").children("li").size();if(!c&&a.size()==0){c=true;a=this.container}if(e.cut_copy.copy_nodes&&e.cut_copy.copy_nodes.size()){var f=
true;if(!c&&!this.check_move(e.cut_copy.copy_nodes,a.children("a:eq(0)"),"inside"))return false;var g=a.children("ul").size()==0||c==true&&a.children("ul").children("li").size()==0?c?this.moved(e.cut_copy.copy_nodes,this.container.children("ul:eq(0)"),"inside",true):this.moved(e.cut_copy.copy_nodes,a.children("a:eq(0)"),"inside",true):d=="before"&&a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").size()?this.moved(e.cut_copy.copy_nodes,a.children("ul:eq(0)").children("li:nth-child("+(b+1)+
")").children("a:eq(0)"),"before",true):d=="after"&&a.children("ul:eq(0)").children("li:nth-child("+b+")").size()?this.moved(e.cut_copy.copy_nodes,a.children("ul:eq(0)").children("li:nth-child("+b+")").children("a:eq(0)"),"after",true):a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").size()?this.moved(e.cut_copy.copy_nodes,a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").children("a:eq(0)"),"before",true):this.moved(e.cut_copy.copy_nodes,a.children("ul:eq(0)").children("li:last").children("a:eq(0)"),
"after",true);e.cut_copy.copy_nodes=false}if(e.cut_copy.cut_nodes&&e.cut_copy.cut_nodes.size()){f=true;a.parents().andSelf().each(function(){if(e.cut_copy.cut_nodes.index(this)!=-1)return f=false});if(!f)return this.error("Invalid paste");if(!c&&!this.check_move(e.cut_copy.cut_nodes,a.children("a:eq(0)"),"inside"))return false;g=a.children("ul").size()==0||c==true&&a.children("ul").children("li").size()==0?c?this.moved(e.cut_copy.cut_nodes,this.container.children("ul:eq(0)"),"inside"):this.moved(e.cut_copy.cut_nodes,
a.children("a:eq(0)"),"inside"):d=="before"&&a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").size()?this.moved(e.cut_copy.cut_nodes,a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").children("a:eq(0)"),"before"):d=="after"&&a.children("ul:eq(0)").children("li:nth-child("+b+")").size()?this.moved(e.cut_copy.cut_nodes,a.children("ul:eq(0)").children("li:nth-child("+b+")").children("a:eq(0)"),"after"):a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").size()?this.moved(e.cut_copy.cut_nodes,
a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").children("a:eq(0)"),"before"):this.moved(e.cut_copy.cut_nodes,a.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after");e.cut_copy.cut_nodes=false}},search:function(a,b){var c=this;if(!a||this.srch&&a!=this.srch){this.srch="";this.srch_opn=false;this.container.find("a.search").removeClass("search")}if(this.srch=a){b||(b="contains");if(this.settings.data.async)if(this.srch_opn)if(this.srch_opn.length){if(this.srch_opn&&this.srch_opn.length){for(var d=
false,f=0;f<this.srch_opn.length;f++)if(this.get_node("#"+this.srch_opn[f]).size()>0){d=true;var g="#"+this.srch_opn[f];delete this.srch_opn[f];this.open_branch(g,true,function(){c.search.apply(c,[a,b])})}if(!d){this.srch_opn=[];c.search.apply(c,[a,b])}}}else{this.srch_opn=false;d="a";if(this.settings.languages.length)d+="."+this.current_lang;this.callback("onsearch",[this.container.find(d+":"+b+"('"+a+"')"),this])}else{d=h.extend({search:a},this.callback("beforedata",[false,this]));h.ajax({type:this.settings.data.opts.method,
url:this.settings.data.opts.url,data:d,dataType:"text",success:function(j){c.srch_opn=h.unique(j.split(","));c.search.apply(c,[a,b])}})}else{d="a";if(this.settings.languages.length)d+="."+this.current_lang;d=this.container.find(d+":"+b+"('"+a+"')");d.parents("li.closed").each(function(){c.open_branch(this,true)});this.callback("onsearch",[d,this])}}},add_sheet:e.add_sheet,destroy:function(){this.callback("ondestroy",[this]);this.container.unbind(".jstree");h("#"+this.container.attr("id")).die("click.jstree").die("dblclick.jstree").die("mouseover.jstree").die("mouseout.jstree").die("mousedown.jstree");
this.container.removeClass("tree ui-widget ui-widget-content tree-default tree-"+this.settings.ui.theme_name).children("ul").removeClass("no_dots ltr locked").find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked hover search");if(this.cntr==e.focused)for(var a in e.inst)if(a!=this.cntr&&a!=this.container.attr("id")){e.inst[a].focus();break}e.inst[this.cntr]=false;e.inst[this.container.attr("id")]=false;delete e.inst[this.cntr];
delete e.inst[this.container.attr("id")];e.cntr--}}}h.tree={datastores:{},plugins:{},defaults:{data:{async:false,type:"html",opts:{method:"GET",url:false}},selected:false,opened:[],languages:[],ui:{dots:true,animation:0,scroll_spd:4,theme_path:false,theme_name:"default",selected_parent_close:"select_parent",selected_delete:"select_previous"},types:{"default":{clickable:true,renameable:true,deletable:true,creatable:true,draggable:true,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:false,
position:false}}},rules:{multiple:false,multitree:"none",type_attr:"rel",createat:"bottom",drag_copy:"ctrl",drag_button:"left",use_max_children:true,use_max_depth:true,max_children:-1,max_depth:-1,valid_children:"all"},lang:{new_node:"New folder",loading:"Loading ..."},callback:{beforechange:function(){return true},beforeopen:function(){return true},beforeclose:function(){return true},beforemove:function(){return true},beforecopy:function(){return true},beforecreate:function(){return true},beforerename:function(){return true},
beforedelete:function(){return true},beforedata:function(a){return{id:h(a).attr("id")||0}},ondata:function(a){return a},onparse:function(a){return a},onhover:function(){},onselect:function(){},ondeselect:function(){},onchange:function(){},onrename:function(){},onmove:function(){},oncopy:function(){},oncreate:function(){},ondelete:function(){},onopen:function(){},onopen_all:function(){},onclose_all:function(){},onclose:function(){},error:function(){},ondblclk:function(a){this.toggle_branch(a.node);
this.select_branch(a.node)},onrgtclk:function(){},onload:function(){},oninit:function(){},onfocus:function(){},ondestroy:function(){},onsearch:function(a){a.addClass("search")},ondrop:function(){},check:function(a,b,c){return c},check_move:function(){return true}},plugins:{}},create:function(){return new e},focused:function(){return e.inst[e.focused]},reference:function(a){var b=h(a);b.size()||(b=h("#"+a));if(!b.size())return null;b=b.is(".tree")?b.attr("id"):b.parents(".tree:eq(0)").attr("id");return e.inst[b]||
null},rollback:function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=e.inst[b],d=!c.locked;d&&c.lock(true);c.inp=false;c.container.html(a[b].html).find(".dragged").removeClass("dragged").end().find(".hover").removeClass("hover");if(a[b].selected){c.selected=h("#"+a[b].selected);c.selected_arr=[];c.container.find("a.clicked").each(function(){c.selected_arr.push(c.get_node(this))})}d&&c.lock(false);delete d;delete c}},drop_mode:function(a){a=h.extend(a,{show:false,type:"default",str:"Foreign node"});
e.drag_drop.foreign=true;e.drag_drop.isdown=true;e.drag_drop.moving=true;e.drag_drop.appended=false;e.drag_drop.f_type=a.type;e.drag_drop.f_data=a;if(a.show){e.drag_drop.drag_help=h("<div id='jstree-dragged' class='tree tree-default'><ul><li class='last dragged foreign'><a href='#'><ins>&nbsp;</ins>"+a.str+"</a></li></ul></div>");e.drag_drop.drag_node=e.drag_drop.drag_help.find("li:eq(0)")}else{e.drag_drop.drag_help=false;e.drag_drop.drag_node=false}h.tree.drag_start!==false&&h.tree.drag_start.call(null,
false)},drag_start:false,drag:false,drag_end:false};h.fn.tree=function(a){return this.each(function(){var b=h.extend({},a);e.inst&&e.inst[h(this).attr("id")]&&e.inst[h(this).attr("id")].destroy();b!==false&&(new e).init(this,b)})};e.cntr=0;e.inst={};e.themes=[];e.drag_drop={isdown:false,drag_node:false,drag_help:false,dragged:false,init_x:false,init_y:false,moving:false,origin_tree:false,marker:false,move_type:false,ref_node:false,appended:false,foreign:false,droppable:[],open_time:false,scroll_time:false};
e.mouseup=function(a){var b=e.drag_drop;b.open_time&&clearTimeout(b.open_time);b.scroll_time&&clearTimeout(b.scroll_time);b.moving&&h.tree.drag_end!==false&&h.tree.drag_end.call(null,a,b);if(b.foreign===false&&b.drag_node&&b.drag_node.size()){b.drag_help.remove();if(b.move_type){var c=e.inst[b.ref_node.parents(".tree:eq(0)").attr("id")];if(c)c.moved(b.dragged,b.ref_node,b.move_type,b.origin_tree.settings.rules.drag_copy=="on"||b.origin_tree.settings.rules.drag_copy=="ctrl"&&(a.ctrlKey||a.metaKey))}b.move_type=
false;b.ref_node=false}if(b.foreign!==false){b.drag_help&&b.drag_help.remove();if(b.move_type)(c=e.inst[b.ref_node.parents(".tree:eq(0)").attr("id")])&&c.callback("ondrop",[b.f_data,c.get_node(b.ref_node).get(0),b.move_type,c]);b.foreign=false;b.move_type=false;b.ref_node=false}e.drag_drop.marker&&e.drag_drop.marker.hide();b.dragged&&b.dragged.size()&&b.dragged.removeClass("dragged");b.dragged=false;b.drag_help=false;b.drag_node=false;b.f_type=false;b.f_data=false;b.init_x=false;b.init_y=false;b.moving=
false;b.appended=false;b.origin_tree=false;if(b.isdown){b.isdown=false;a.preventDefault();a.stopPropagation();return false}};e.mousemove=function(a){var b=e.drag_drop,c=false;if(b.isdown){if(!b.moving&&Math.abs(b.init_x-a.pageX)<5&&Math.abs(b.init_y-a.pageY)<5){a.preventDefault();a.stopPropagation();return false}else if(!b.moving)c=e.drag_drop.moving=true;b.open_time&&clearTimeout(b.open_time);if(b.drag_help!==false){if(!b.appended){if(b.foreign!==false)b.origin_tree=h.tree.focused();h("body").append(b.drag_help);
b.w=b.drag_help.width();b.appended=true}b.drag_help.css({left:a.pageX+5,top:a.pageY+15})}c&&h.tree.drag_start!==false&&h.tree.drag_start.call(null,a,b);h.tree.drag!==false&&h.tree.drag.call(null,a,b);if(a.target.tagName=="DIV"&&a.target.id=="jstree-marker")return false;var d=h(a.target);if(d.is("ins"))d=d.parent();c=d.is(".tree")?d:d.parents(".tree:eq(0)");if(c.size()==0||!e.inst[c.attr("id")]){b.scroll_time&&clearTimeout(b.scroll_time);b.drag_help!==false&&b.drag_help.find("li:eq(0) ins").addClass("forbidden");
b.move_type=false;b.ref_node=false;e.drag_drop.marker.hide();return false}var f=e.inst[c.attr("id")];f.off_height();b.scroll_time&&clearTimeout(b.scroll_time);b.scroll_time=setTimeout(function(){f.scroll_check(a.pageX,a.pageY)},50);var g=false;c.scrollTop();if(a.target.tagName=="A"||a.target.tagName=="INS"){if(d.is("#jstree-dragged"))return false;if(f.get_node(a.target).hasClass("closed"))b.open_time=setTimeout(function(){f.open_branch(d)},500);var j=d.offset(),k={x:j.left-1,y:a.pageY-j.top},l=[];
l=k.y<f.li_height/3+1?["before","inside","after"]:k.y>f.li_height*2/3-1?["after","inside","before"]:k.y<f.li_height/2?["inside","before","after"]:["inside","after","before"];var n=false,o=b.foreign==false?b.origin_tree.container.find("li.dragged"):b.f_type;h.each(l,function(m,p){if(f.check_move(o,d,p)){g=p;n=true;return false}});if(n){switch(g){case "before":k.y=j.top-2;e.drag_drop.marker.attr("class","marker");break;case "after":k.y=j.top-2+f.li_height;e.drag_drop.marker.attr("class","marker");break;
case "inside":k.x-=2;k.y=j.top-2+f.li_height/2;e.drag_drop.marker.attr("class","marker_plus");break}b.move_type=g;b.ref_node=h(a.target);b.drag_help!==false&&b.drag_help.find(".forbidden").removeClass("forbidden");e.drag_drop.marker.css({left:k.x,top:k.y}).show()}}if((d.is(".tree")||d.is("ul"))&&d.find("li:eq(0)").size()==0){j=d.offset();b.move_type="inside";b.ref_node=c.children("ul:eq(0)");b.drag_help!==false&&b.drag_help.find(".forbidden").removeClass("forbidden");e.drag_drop.marker.attr("class",
"marker_plus");e.drag_drop.marker.css({left:j.left+10,top:j.top+15}).show()}else if(a.target.tagName!="A"&&a.target.tagName!="INS"||!n){b.drag_help!==false&&b.drag_help.find("li:eq(0) ins").addClass("forbidden");b.move_type=false;b.ref_node=false;e.drag_drop.marker.hide()}a.preventDefault();a.stopPropagation();return false}return true};h(function(){h(document).bind("mousemove.jstree",e.mousemove);h(document).bind("mouseup.jstree",e.mouseup)});e.cut_copy={copy_nodes:false,cut_nodes:false};e.css=false;
e.get_css=function(a,b){a=a.toLowerCase();var c=e.css.cssRules||e.css.rules,d=0;do{if(c.length&&d>c.length+5)return false;if(c[d].selectorText&&c[d].selectorText.toLowerCase()==a)if(b==true){e.css.removeRule&&document.styleSheets[i].removeRule(d);e.css.deleteRule&&document.styleSheets[i].deleteRule(d);return true}else return c[d]}while(c[++d]);return false};e.add_css=function(a){if(e.get_css(a))return false;e.css.insertRule?e.css.insertRule(a+" { }",0):e.css.addRule(a,null,0);return e.get_css(a)};
e.remove_css=function(a){return e.get_css(a,true)};e.add_sheet=function(a){if(a.str){var b=document.createElement("style");b.setAttribute("type","text/css");if(b.styleSheet){document.getElementsByTagName("head")[0].appendChild(b);b.styleSheet.cssText=a.str}else{b.appendChild(document.createTextNode(a.str));document.getElementsByTagName("head")[0].appendChild(b)}return b.sheet||b.styleSheet}if(a.url)if(document.createStyleSheet)try{document.createStyleSheet(a.url)}catch(c){}else{b=document.createElement("link");
b.rel="stylesheet";b.type="text/css";b.media="all";b.href=a.url;document.getElementsByTagName("head")[0].appendChild(b);return b.styleSheet}};h(function(){var a=navigator.userAgent.toLowerCase(),b=(a.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],c='/* TREE LAYOUT */ .tree ul { margin:0 0 0 5px; padding:0 0 0 0; list-style-type:none; } .tree li { display:block; min-height:18px; line-height:18px; padding:0 0 0 15px; margin:0 0 0 0; /* Background fix */ clear:both; } .tree li ul { display:none; } .tree li a, .tree li span { display:inline-block;line-height:16px;height:16px;color:black;white-space:nowrap;text-decoration:none;padding:1px 4px 1px 4px;margin:0; } .tree li a:focus { outline: none; } .tree li a input, .tree li span input { margin:0;padding:0 0;display:inline-block;height:12px !important;border:1px solid white;background:white;font-size:10px;font-family:Verdana; } .tree li a input:not([class="xxx"]), .tree li span input:not([class="xxx"]) { padding:1px 0; } /* FOR DOTS */ .tree .ltr li.last { float:left; } .tree > ul li.last { overflow:visible; } /* OPEN OR CLOSE */ .tree li.open ul { display:block; } .tree li.closed ul { display:none !important; } /* FOR DRAGGING */ #jstree-dragged { position:absolute; top:-10px; left:-10px; margin:0; padding:0; } #jstree-dragged ul ul ul { display:none; } #jstree-marker { padding:0; margin:0; line-height:5px; font-size:1px; overflow:hidden; height:5px; position:absolute; left:-45px; top:-30px; z-index:1000; background-color:transparent; background-repeat:no-repeat; display:none; } #jstree-marker.marker { width:45px; background-position:-32px top; } #jstree-marker.marker_plus { width:5px; background-position:right top; } /* BACKGROUND DOTS */ .tree li li { overflow:hidden; } .tree > .ltr > li { display:table; } /* ICONS */ .tree ul ins { display:inline-block; text-decoration:none; width:16px; height:16px; } .tree .ltr ins { margin:0 4px 0 0px; } ';
if(/msie/.test(a)&&!/opera/.test(a)){if(parseInt(b)==6)c+='.tree li { height:18px; zoom:1; } .tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); } .marker { width:45px; background-position:-32px top; } .marker_plus { width:5px; background-position:right top; }';if(parseInt(b)==7)c+='.tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); }'}if(/opera/.test(a))c+=
'.tree > ul > li.last:after { content:"."; display: block; height:1px; clear:both; visibility:hidden; }';if(/mozilla/.test(a)&&!/(compatible|webkit)/.test(a)&&b.indexOf("1.8")==0)c+=".tree .ltr li a { display:inline; float:left; } .tree li ul { clear:both; }";e.css=e.add_sheet({str:c})})})(jQuery);
(function(h){h.extend(h.tree.datastores,{html:function(){return{get:function(e,a){return e&&h(e).size()?h("<div>").append(a.get_node(e).clone()).html():a.container.children("ul:eq(0)").html()},parse:function(e,a,b,c){c&&c.call(null,e);return e},load:function(e,a,b,c){b.url?h.ajax({type:b.method,url:b.url,data:e,dataType:"html",success:function(d){c.call(null,d)},error:function(d,f,g){c.call(null,false);a.error(g+" "+f)}}):c.call(null,b.staticData||a.container.children("ul:eq(0)").html())}}},json:function(){return{get:function(e,
a,b){var c=this;e=!e||h(e).size()==0?a.container.children("ul").children("li"):h(e);b||(b={});if(!b.outer_attrib)b.outer_attrib=["id","rel","class"];if(!b.inner_attrib)b.inner_attrib=[];if(e.size()>1){var d=[];e.each(function(){d.push(c.get(this,a,b))});return d}if(e.size()==0)return[];var f={attributes:{},data:{}};if(e.hasClass("open"))f.state="open";if(e.hasClass("closed"))f.state="closed";for(var g in b.outer_attrib)if(b.outer_attrib.hasOwnProperty(g)){var j=b.outer_attrib[g]=="class"?e.attr(b.outer_attrib[g]).replace(/(^| )last( |$)/ig,
" ").replace(/(^| )(leaf|closed|open)( |$)/ig," "):e.attr(b.outer_attrib[g]);if(typeof j!="undefined"&&j.toString().replace(" ","").length>0)f.attributes[b.outer_attrib[g]]=j;delete j}if(a.settings.languages.length)for(g in a.settings.languages){if(a.settings.languages.hasOwnProperty(g)){var k=e.children("a."+a.settings.languages[g]);if(b.force||b.inner_attrib.length||k.children("ins").get(0).style.backgroundImage.toString().length||k.children("ins").get(0).className.length){f.data[a.settings.languages[g]]=
{};f.data[a.settings.languages[g]].title=a.get_text(e,a.settings.languages[g]);if(k.children("ins").get(0).style.className.length)f.data[a.settings.languages[g]].icon=k.children("ins").get(0).style.className;if(k.children("ins").get(0).style.backgroundImage.length)f.data[a.settings.languages[g]].icon=k.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","");if(b.inner_attrib.length){f.data[a.settings.languages[g]].attributes={};for(var l in b.inner_attrib)if(b.inner_attrib.hasOwnProperty(l)){j=
k.attr(b.inner_attrib[l]);if(typeof j!="undefined"&&j.toString().replace(" ","").length>0)f.data[a.settings.languages[g]].attributes[b.inner_attrib[l]]=j;delete j}}}else f.data[a.settings.languages[g]]=a.get_text(e,a.settings.languages[g])}}else{k=e.children("a");f.data.title=a.get_text(e);if(k.children("ins").size()&&k.children("ins").get(0).className.length)f.data.icon=k.children("ins").get(0).className;if(k.children("ins").size()&&k.children("ins").get(0).style.backgroundImage.length)f.data.icon=
k.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","");if(b.inner_attrib.length){f.data.attributes={};for(l in b.inner_attrib)if(b.inner_attrib.hasOwnProperty(l)){j=k.attr(b.inner_attrib[l]);if(typeof j!="undefined"&&j.toString().replace(" ","").length>0)f.data.attributes[b.inner_attrib[l]]=j;delete j}}}if(e.children("ul").size()>0){f.children=[];e.children("ul").children("li").each(function(){f.children.push(c.get(this,a,b))})}return f},parse:function(e,a,b,c){if(Object.prototype.toString.apply(e)===
"[object Array]"){for(var d="",f=0;f<e.length;f++)if(typeof e[f]!="function")d+=this.parse(e[f],a,b);c&&c.call(null,d);return d}if(!e||!e.data){c&&c.call(null,false);return""}d="";d+="<li ";var g=false;if(e.attributes)for(f in e.attributes)if(e.attributes.hasOwnProperty(f))if(f=="class"){d+=" class='"+e.attributes[f]+" ";if(e.state=="closed"||e.state=="open")d+=" "+e.state+" ";d+="' ";g=true}else d+=" "+f+"='"+e.attributes[f]+"' ";if(!g&&(e.state=="closed"||e.state=="open"))d+=" class='"+e.state+
"' ";d+=">";if(a.settings.languages.length)for(f=0;f<a.settings.languages.length;f++){g={};g.href="";g.style="";g["class"]=a.settings.languages[f];if(e.data[a.settings.languages[f]]&&(typeof e.data[a.settings.languages[f]].attributes).toLowerCase()!="undefined")for(var j in e.data[a.settings.languages[f]].attributes)if(e.data[a.settings.languages[f]].attributes.hasOwnProperty(j))if(j=="style"||j=="class")g[j]+=" "+e.data[a.settings.languages[f]].attributes[j];else g[j]=e.data[a.settings.languages[f]].attributes[j];
d+="<a";for(j in g)if(g.hasOwnProperty(j))d+=" "+j+'="'+g[j]+'" ';d+=">";d+=e.data[a.settings.languages[f]]&&e.data[a.settings.languages[f]].icon?"<ins "+(e.data[a.settings.languages[f]].icon.indexOf("/")==-1?" class='"+e.data[a.settings.languages[f]].icon+"' ":" style='background-image:url(\""+e.data[a.settings.languages[f]].icon+"\");' ")+">&nbsp;</ins>":"<ins>&nbsp;</ins>";d+=((typeof e.data[a.settings.languages[f]].title).toLowerCase()!="undefined"?e.data[a.settings.languages[f]].title:e.data[a.settings.languages[f]])+
"</a>"}else{g={};g.href="";g.style="";g["class"]="";if((typeof e.data.attributes).toLowerCase()!="undefined")for(f in e.data.attributes)if(e.data.attributes.hasOwnProperty(f))if(f=="style"||f=="class")g[f]+=" "+e.data.attributes[f];else g[f]=e.data.attributes[f];d+="<a";for(f in g)if(g.hasOwnProperty(f))d+=" "+f+'="'+g[f]+'" ';d+=">";d+=e.data.icon?"<ins "+(e.data.icon.indexOf("/")==-1?" class='"+e.data.icon+"' ":" style='background-image:url(\""+e.data.icon+"\");' ")+">&nbsp;</ins>":"<ins>&nbsp;</ins>";
d+=((typeof e.data.title).toLowerCase()!="undefined"?e.data.title:e.data)+"</a>"}if(e.children&&e.children.length){d+="<ul>";for(f=0;f<e.children.length;f++)d+=this.parse(e.children[f],a,b);d+="</ul>"}d+="</li>";c&&c.call(null,d);return d},load:function(e,a,b,c){b.staticData?c.call(null,b.staticData):h.ajax({type:b.method,url:b.url,data:e,dataType:"json",success:function(d){c.call(null,d)},error:function(d,f,g){c.call(null,false);a.error(g+" "+f)}})}}}})})(jQuery);